name: Daily Strava Sync

on:
  schedule:
    # Ejecutar diariamente a las 6:00 AM UTC
    - cron: '0 6 * * *'
  workflow_dispatch: # Permitir ejecución manual

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
    
    - name: Run daily sync
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
        STRAVA_CLIENT_ID: ${{ secrets.STRAVA_CLIENT_ID }}
        STRAVA_CLIENT_SECRET: ${{ secrets.STRAVA_CLIENT_SECRET }}
        APP_URL: ${{ secrets.APP_URL }}
      run: |
        python scripts/daily_sync.py --days 7
    
    - name: Notify on failure
      if: failure()
      run: |
        echo "❌ Sync failed - check logs"
        # Aquí puedes agregar notificación por email o Slack

  backup:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 6 * * 0' # Solo domingos
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Create database backup
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
      run: |
        # Script de backup (adaptar según tu DB)
        echo "Creating backup..."
        # pg_dump $DATABASE_URL > backup_$(date +%Y%m%d).sql